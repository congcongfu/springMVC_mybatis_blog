<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3.0-mapper.dtd">  
<mapper namespace="com.congfu.dao.UserDao">  
  <resultMap id="studentResultMap" type="com.congfu.model.User" >
  	<id property="id" column="id"/>
  	<result property="userName" column="userName"/>
  	<result property="password" column="password" />
  	<result property="email" column="email" />
  	<result property="loginCount" column="loginCount" />
  	<result property="lastLoginIp" column="lastLoginIp" />
  	<result property="lastLoginTime" column="lastLoginTime" />
  	<result property="authkey" column="authkey" />
  	<result property="active" column="active" />
  	<result property="phoneNumber" column="phoneNumber" />
  	<result property="isDeleted" column="isDeleted" />
  	<result property="createTime" column="createTime" />
  	<result property="updateTime" column="updateTime" />
  	<result property="createMan" column="createMan" />
  	<result property="updateMan" column="updateMan" />
  </resultMap>
  <!--新增用户信息 -->
  <insert id="insert" parameterType="com.congfu.model.User" useGeneratedKeys="true" keyProperty="id">
  	insert into user(userName,password,email,loginCount,lastLoginIp,lastLoginTime,authkey,active,phoneNumber,isDeleted,
  	createTime,updateTime,createMan,updateMan)
  	 values(#{userName},#{password},#{email},#{loginCount},#{lastLoginIp},#{lastLoginTime},#{authkey},#{active},#{phoneNumber},#{isDeleted},
  	 now(),#{updateTime},#{createMan},#{updateMan})
  </insert>
  <!-- 批量插入 -->
<!--   <insert id="batchInsert" parameterType="com.congfu.model.blog.Blog" useGeneratedKeys="true" keyProperty="id">
  	insert into blog(userId,author,title,color,urlName,urlType,content,tags,view,status,publishTime,isDeleted,
  	isTop,createTime,updateTime,createMan,updateMan,version) values
  	<foreach item="item" collection="list" separator=",">
	  (#{userId},#{author},#{title},#{color},#{urlName},#{urlType},#{content},#{tags},#{view},#{status},#{publishTime},#{isDeleted},
	   #{isTop},now(),#{updateTime},#{createMan},#{updateMan},0)
  	</foreach>
  </insert> -->
  <!-- 根据id 查询用户 -->
   <select id="findById" parameterType="Long" resultType="com.congfu.model.User">
 	 select id,userName,
 	 		password,email,loginCount,
 	 		lastLoginIp,lastLoginTime,
 	 		authkey,active,
  			phoneNumber,isDeleted,
  			createTime,updateTime,
  			createMan,updateMan
  		from user
  		where id=#{id}
  </select> 
  <!-- 根据id 更新 -->
  <update id="update" parameterType="com.congfu.model.User">
  	update user
  	<trim prefix="SET" suffixOverrides=",">
  		<if test="password != null">password=#{password},</if>
  		<if test="email != null"> email=#{email},</if>
  		<if test="loginCount != null"> loginCount=#{loginCount},</if>
  		<if test="lastLoginIp != null"> lastLoginIp=#{lastLoginIp},</if>
  		<if test="lastLoginTime != null"> lastLoginTime=#{lastLoginTime},</if>
  		<if test="authkey != null"> authkey=#{authkey},</if>
  		<if test="isDeleted != null"> isDeleted=#{isDeleted},</if>
  		<if test="phoneNumber != null"> phoneNumber=#{phoneNumber},</if>
  		<if test="updateMan != null"> updateMan=#{updateMan},</if>
  		<if test="updateTime != null"> updateTime=#{updateTime},</if>
  	</trim>
  	where id =#{id}
  </update>
  <!-- 条件查询 -->
   <select id="query" parameterType="com.congfu.query.UserQuery" resultMap="studentResultMap">
 	 select id,userName,
 	 		password,email,loginCount,
 	 		lastLoginIp,lastLoginTime,
 	 		authkey,active,
  			phoneNumber,isDeleted,
  			createTime,updateTime,
  			createMan,updateMan
  		from user
  		<trim prefix="WHERE(" suffix=")" prefixOverrides="AND |OR "> 
		    <if test="userName != null">
		       AND  userName = #{userName}
		    </if> 
		    <if test="email != null">
		       AND  email like CONCAT(CONCAT('',#{email}),'%') 
		    </if>
		     <if test="lastLoginIp != null">
		       AND  lastLoginIp=#{lastLoginIp}
		    </if>
		    <if test="createMan != null">
		       AND  createMan=#{createMan}
		    </if>
		     <if test="updateMan != null">
		       AND  updateMan=#{updateMan}
		    </if>
		    <if test="phoneNumber != null">
		       AND  phoneNumber like CONCAT(CONCAT('',#{phoneNumber}),'%')
		    </if>
		    <if test="isDeleted != null">
		       AND  isDeleted＝#{isDeleted}
		    </if>
		    <if test="lastLoginTimeBegin != null">
		       AND  lastLoginTime<![CDATA[ >= #{lastLoginTimeBegin}]]>
		    </if>
		    <if test="lastLoginTimeEnd != null">
		       AND  lastLoginTime<![CDATA[<#{lastLoginTimeEnd}]]>
		    </if>
		    <if test="createTimeBegin != null">
		       AND  createTime<![CDATA[ >= #{createTimeBegin}]]>
		    </if>
		    <if test="createTimeEnd != null">
		       AND  createTime<![CDATA[<#{createTimeEnd}]]>
		    </if>
  	</trim>
  </select> 
</mapper>















